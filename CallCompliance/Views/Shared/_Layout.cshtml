<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    @Styles.Render("~/Content/css")
    @Styles.Render("~/Content/charts");
    <link rel="stylesheet" href="~/Content/site.css" />
    @Scripts.Render("~/bundles/modernizr")
</head>

<body>
<nav class="navbar navbar-dark navbar-fixed-top bg-primary">
    <div class="form-inline row">
        <div class="col-sm-9">
            @if (User.IsInRole("Call_Frequency_Users_SG") || User.IsInRole("Call_Frequency_Admins_SG")) {
                <span class="navbar-brand">Welcome to the Call Compliance Portal @MyHelpers.UserFullName()!</span>
            }
            else {
                <span class="navbar-brand">@MyHelpers.UserFullName(), Sorry but you don't have rights to use Call Compliance.</span>
            }
            <span class="nav-item col-sm-3 pull-right">
                    <i class="fa fa-search" onclick="FindPhoneNumber()"></i>
                    <input type="text" class="nav-inline" id="phoneNumSearch" maxlength="100">
            </span>
            @*<span class="inner-addon left-addon">
                <i class="fa fa-search" onclick="FindPhoneNumber()"></i>
                <input type="text" class="form-control" />
                <i class="fa fa-search" onclick="FindPhoneNumber()"></i>
                <input type="text" class="nav-inline" id="phoneNumSearch" maxlength="100">
			</span>*@
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        @if (User.IsInRole("Call_Frequency_Users_SG") || User.IsInRole("Call_Frequency_Admins_SG")) {
            <div class="col-sm-3 col-md-2 sidebar">
                <nav class="nav nav-pills nav-stacked nav-sidebar">
                    <a id="menu-home" class="nav-link" href="/Home">
                        <span style="width: 55px" class="fa fa-2x fa fa-home"></span> Home
                    </a>
                    <a id="menu-unblock" class="nav-link" href="/Unblock">
                        <span style="width: 55px" class="fa fa-2x fa-thumbs-up"  a href="#" data-toggle="popover" title="Exception Cap" data-content="Daily Exception Call Cap"></span>Exception Call Cap
                    </a>
                    <a id="menu-cooldown" class="nav-link" href="/CoolDown">
                        <span style="width: 55px" class="fa fa-2x fa-shower"></span> No Call Period
                    </a>
                    <a id="menu-dnc" class="nav-link" href="/DNC">
                        <span style="width: 55px" class="fa fa-2x fa-user-times"></span> DNC
                    </a>
				@if (User.IsInRole("Call_Frequency_Admins_SG")) {
                    <a id="menu-whitelist" class="nav-link" href="/WhiteList">
                        <span style="width: 55px" class="fa fa-2x fa-snowflake-o"></span> White List
                    </a>
				}
                    <a id="menu-reporting" class="nav-link" href="/Reporting">
                        <span style="width: 55px" class="fa fa-2x fa-file-text-o"></span> Reporting
                    </a>

                @if (User.IsInRole("Call_Frequency_Admins_SG")) {
                    <a id="menu-admin" class="nav-link" href="/Admin">
                        <span style="width: 55px" class="fa fa-2x fa-user-circle-o"></span> Admin
                    </a>
                }
                </nav>

            </div>

            <div class="col-md-6 offset-md-3 main">
                @RenderBody()
            </div>
        }
    </div>
</div>


@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/jqueryval")
@Scripts.Render("~/bundles/bootstrap")

@RenderSection("scripts", required: false)
</body>
</html>

<script>
    $(document)
        .ready(function() {
            $('[data-toggle="popover"]').popover();
        });

    function FindPhoneNumber () {

        var url = '/Home/GetTableName/';
        var phoneNumber = $("#phoneNumSearch").val();

        var jsonData = ko.toJSON({ "phoneNumber": phoneNumber });

        var result = postJSON(url, jsonData, false);

        if (result === null) {
            return;
        }

        if (result.length === 0) {
			modal({
				type: 'inverted',
				title: "Not Found",
				text: phoneNumber + " not found in any table.",
				size: 'normal',
				buttons: [
					{
						text: 'OK',
						val: 'ok',
						eKey: true,
						addClass: 'btn-light-blue'
					}
				]
			});

        } else if (result.length === 1) {
            var menu = result[0].TableName.toUpperCase();
            switch (menu) {
				case "COOLDOWN":
					
				$("#menu-home").removeClass("active");
				$("#menu-unblock").removeClass("active");
				$("#menu-dnc").removeClass("active");
				$("#menu-whitelist").removeClass("active");
				$("#menu-reporting").removeClass("active");
				$("#menu-admin").removeClass("active");

				$("#menu-cooldown").addClass("active");

                break;
            case "EXCEPTION":

					$("#menu-home").removeClass("active");
					$("#menu-cooldown").removeClass("active");
					$("#menu-dnc").removeClass("active");
					$("#menu-whitelist").removeClass("active");
					$("#menu-reporting").removeClass("active");
					$("#menu-admin").removeClass("active");

					$("#menu-unblock").addClass("active");
                break;
            case "WHITELIST":

					$("#menu-home").removeClass("active");
					$("#menu-unblock").removeClass("active");
					$("#menu-cooldown").removeClass("active");
					$("#menu-dnc").removeClass("active");
					$("#menu-reporting").removeClass("active");
					$("#menu-admin").removeClass("active");

					$("#menu-whitelist").addClass("active");
                break;
            case "DNC":

					$("#menu-home").removeClass("active");
					$("#menu-unblock").removeClass("active");
					$("#menu-cooldown").removeClass("active");
					$("#menu-whitelist").removeClass("active");
					$("#menu-reporting").removeClass("active");
					$("#menu-admin").removeClass("active");

					$("#menu-dnc").addClass("active");
                break;
            }
        } else {
            var menuItems = [];
            var maxItems = result.length;

            for (i = 0; i < 10 && i < maxItems; i++) {
                menuItems.push("Phone Number " + phoneNumber + " found in table (" + result[i].TableName + ")</br>");
            }
            modal({
                type: 'inverted',
                title: "Phone Number found in multiple tables.",
                text: menuItems,
                size: 'normal',
                buttons: [
                    {
                        text: 'OK',
                        val: 'ok',
                        eKey: true,
                        addClass: 'btn-light-blue'
                    }
                ]
            });
        }


      
        //
        // this method is now allows you to do a post sync or async. 
        // the sync method works as it always did, just need to pass in
        // address, json and async set to true - false.
        // the async call requires the a callback method and 
        // showBusy set to true if you want to block the UI
        //
        function postJSON(address, json, async, asyncCallBackFn, showBusy) {
            var ajaxUrl = address;
            var args;
            var result;

            args = Array.prototype.slice.call(arguments, 5);

            if (async === null) {
                async = false;
            }
            if (async && asyncCallBackFn === null) {
                //throw new UserException('async method called with no callback method', '');
            }
            if (showBusy === null) {
                showBusy = false;
            }
            if (!async) {
                try {
                    $.ajax({
                        url: ajaxUrl,
                        type: 'POST',
                        dataType: 'json',
                        data: json,
                        async: false,
                        contentType: 'application/json;charset=utf-8',
                        traditional: true,
                        success: function (data) {
                            result = data;
                        },
                        error: function (data) {
                            //alert('Json Post Error : ' + data);
                            result = data;
                            //throw new UserException('AjaxException', result);
                        }
                    }
                    );
                } catch (ex) {
                    //showDialog('error', 'An exception has occurred. ' + ex.exceptionName);
                    //alert('An exception has occurred. ' + ex.exceptionName);
                    //postException(ex.exceptionName);
                    return result;
                }
                //Need to check the success message here?
                return result;
            }
            else {
                try {
                    //uma.common.busy(showBusy);
                    $.ajax({
                        url: ajaxUrl,
                        type: 'POST',
                        dataType: 'json',
                        data: json,
                        async: true,
                        contentType: 'application/json;charset=utf-8',
                        traditional: true,
                        success: function (data) {
                            //uma.common.busy(false);
                            args.splice(0, 0, data);
                            asyncCallBackFn.apply(this, args);
                        },
                        error: function (data) {
                           // uma.common.busy(false);
                            //alert('Json Post Error : ' + data);
                            result = data;
                            //throw new UserException('AsyncException', result);
                        }
                    }
                    );
                } catch (ex) {
                    //showDialog('error', 'An exception has occurred. ' + ex.exceptionName);
                    //alert('An exception has occurred. ' + ex.exceptionName);
                    //postException(ex.exceptionName);
                    return result;
                }
                //Need to check the success message here?
                return result;
            }
        }


    }
</script>